<source>
  @type tail
  format json
  read_from_head false
  path /var/log/yellowmessenger/asterisk_ari/asterisk_ari.log
  tag telephonylogs
  pos_file /var/log/fluent/azurestorage/telephony.log.pos
</source>

<source>
    @type http
    port 3001
    bind 0.0.0.0
</source>

<match structlog.**>
    @type route
    remove_tag_prefix structlog
    <route **>
        @label @STTLOG
    </route>
</match>

<label @STTLOG>
    <match **>
        @type azurestorage
        azure_storage_account yellowmessenger
        azure_storage_access_key p30XtiFeffL6bFNnwjEel9e593ReOJInzW06wl4rX9600mur5b9yVURLXnhr80tdM+nmCwwDR3U8uNcSjXWaqQ==
        azure_container logging
        azure_storage_type blob
        store_as json
        auto_create_container false
        path logs/${tag}/yyyy=%Y/mm=%m/dd=%d/
        azure_object_key_format %{path}%{time_slice}_%{index}.%{file_extension}
        time_slice_format %Y%m%d-%H%M
        <buffer tag,time>
            @type file
            path /var/log/fluent/azurestorage/sttlog
            timekey 3600
            timekey_wait 10m
            timekey_use_utc true
            flush_at_shutdown true
        </buffer>
        <format>
            @type json
        </format>
    </match>
</label>


<match telephonylogs.**>
    @type route
    remove_tag_prefix structlog
    <route **>
        @label @AZURELOG
    </route>
</match>

<label @AZURELOG>
    <match **>
        @type azurestorage
        azure_storage_account yellowmessenger
        azure_storage_access_key /qnaZM6BMIwCaeRvhbhbrfzb6t3npUBZDxVMSDgdnJSozd7O3zdurau+yNUXf/FO7XdP1zhQQCnX9/jeyIg2ew==
        azure_container telephony-logs
        azure_storage_type blob
        store_as json
        auto_create_container false
        path yellowmessenger.com
        azure_object_key_format %{path}%{time_slice}_%{index}.%{file_extension}
        time_slice_format %Y%m%d-%H%M
        <buffer tag,time>
            @type file
            path /var/log/fluent/azurestorage
            timekey 3600
            timekey_wait 10m
            timekey_use_utc true
            flush_at_shutdown true
        </buffer>
        <format>
            @type json
        </format>
    </match>
</label>
